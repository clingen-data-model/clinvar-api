# clinvar-api
Software for working with the ClinVar web API


# Components

There is a `clinvar_api/main.py` file with an argument parser and subcommand runner that provides a CLI entrypoint to common functionality.


## Subcommands

### generate

The generate subcommand is used to transform a ClinVar Submission MS Excel file into a ClinVar Submission API payload. It will write to the directory `./submissions/`. It will dump a JSON file for each line in the Excel file as well as a file with `ALL` in the name that contains a single batch submission payload with all of the submissions combined.


```
python clinvar_api/main.py generate \
    --input-file "My-Submitter-2021-05-03.xlsx \
    --submission-name "My_Submitter_2021-05-03" \
    --assertion-criteria-name "My Submitter Specifications v1" \
    --assertion-criteria-url "https://submit.ncbi.nlm.nih.gov/my-submitter-specifications.pdf"
```


### submit

The `submit` subcommand is used to submit a file generated with `generate` and POST it to the ClinVar Submission API endpoint. A submitter API key is required. A `--dry-run true` option is supported to use the API dry run functionality which simply performs a check of the schema, not deeper validation of the values contained in it. Using the dry run option makes it so nothing is stored on the server side, and it can be run as many times as desired.

Example:

```
python clinvar_api/main.py submit \
    --file "submissions/submission-ALL-My_Submitter_2021-05-03.json" \
    --key-file "clinvar-my-submitter-key.txt"
```

The response from the submission will be saved under local directory `./responses/` in a JSON file with a name containing the submission name. In it will be a timestamp and the response in the `content` field, which contains the submission id generated by ClinVar for the submission sent in the request. Note if the same batch of submissions is submitted multiple times by a client even with the same submission name, each request will have it's own submission id generated and returned by ClinVar.

### status

The `status` subcommand performs a query against the status check endpoint for a given submission. The `submit` subcommand automatically performs an immediate status check after submission and writes a local file with the response. The status of a submission changes over time as the contents are processed, validated, and released by ClinVar. If the status response contains an attachment file under `actions[0].responses[0].files[0].url` with a more detailed listing of the individual submission record statuses, it will be automatically fetched and embedded under the `actions[0].responses[0].files[0].value` field as parsed JSON.

```
python clinvar_api/main.py status \
    --sub-id <submission-id-from-clinvar>  \
    --key-file "clinvar-my-submitter-key.txt"
```
